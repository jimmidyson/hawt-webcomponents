<link rel="import" href="kubernetes-perspective.html"/>

<polymer-element name="kubernetes-overview">
  <template>
    <style>
      .pod {
        background-color: #fafafa;
        padding: 16px;
        border-bottom: 1px solid #e0e0e0;
        will-change: transform, opacity;
      }

      .pod[selected] {
        background-color: silver;
      }
    </style>

    <core-localstorage name="kubernetes-apiserver" value="{{kubernetesApiServer}}"></core-localstorage>

    <core-ajax auto url="{{kubernetesApiServer}}/api/v1beta2/pods" handleAs="json" response="{{pods}}" on-core-error="{{onError}}"></core-ajax>

    <paper-toast id="errorToast" text="{{errorMessage}}"></paper-toast>

    <paper-input-decorator label="Kubernetes API Server" error="Input is required!" autovalidate layout vertical floatinglabel>
      <input is="core-input" value="{{kubernetesApiServer}}" required>
    </paper-input-decorator>

    <core-selector selectedAttribute="selected" selected="{{selectedPods}}" multi>
      <template repeat="{{pod in pods.items}}">
        <div class="pod" layout horizontal>
          <div flex layout horizontal>
            <header layout vertical flex>
              <span layout horizontal>
                <span class="name">
                  {{pod.id}}
                </span>
                <span class="ip">
                  ({{pod.currentState.podIP}})
                </span>
                <span class="host">
                  ({{pod.currentState.host}})
                </span>
              </span>
              </span>
            </header>
          </div>
        </div>
      </template>
    </core-selector>
                                                                                                                                                               </core-selector>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        kubernetesApiServer: 'https://localhost:8443',
        onError: function(error) {
          this.errorMessage = error.detail.xhr.responseText;
          this.$.errorToast.show();
        },
      });
    })();
  </script>
</polymer-element>
